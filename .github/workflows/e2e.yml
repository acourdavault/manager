# This workflow run unit tests for the SDK as well as a build. It will then
# run npm publish if the preceding steps succeeded.

# container:
#     image: cypress/browsers:node12.18.0-chrome83-ff77

name: Linode Cloud Manager - E2E

on: push

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Get Dependencies
      runs: yarn install:all
    - uses: cypress-io/github-action@v2
      with:
        browser: chrome
        headless: true
        build: yarn build:sdk
        start: yarn workspace linode-manager start
        wait-on: 'http://localhost:3000/'
        command: yarn cy:e2e --spec ./cypress/integration/smoke-dashboard.spec.ts
      env:
        MANAGER_OAUTH: ${{ secrets.MANAGER_OAUTH }}
        REACT_APP_LAUNCH_DARKLY_ID: ${{ secrets.REACT_APP_LAUNCH_DARKLY_ID }}
        REACT_APP_LOGIN_ROOT: https://login.linode.com
        REACT_APP_API_ROOT: https://api.linode.com/v4
        MANAGER_USER: ${{ secrets.MANAGER_USER }}
